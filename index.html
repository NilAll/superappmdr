<script>
    // --- BANCO DE DADOS E PERSIST√äNCIA ---
    let initialData = { /* ... (teus dados iniciais originais) ... */ };
    let appData = {};

    function saveData() {
        try {
            localStorage.setItem('superAppMDRData', JSON.stringify(appData));
        } catch (error) {
            console.error("Erro ao salvar os dados:", error);
        }
    }

    // ‚úÖ NOVA FUN√á√ÉO ATUALIZADA
    async function loadData() {
        const loadingIndicator = document.getElementById('loading-indicator');
        if (loadingIndicator) loadingIndicator.classList.remove('hidden');

        // üëâ Substitui este link pelo teu link RAW do GitHub:
        const onlineBackupUrl = "https://raw.githubusercontent.com/NilAll/bkpsuperappmdr/refs/heads/main/super-app-mdr-dados-20251002%20(2).json";

        try {
            // 1Ô∏è‚É£ Tenta carregar o JSON hospedado no GitHub
            const response = await fetch(onlineBackupUrl, { cache: "no-store" });
            if (!response.ok) throw new Error("N√£o foi poss√≠vel carregar o backup online");

            const remoteData = await response.json();
            Object.assign(appData, remoteData);
            console.log("‚úÖ Dados importados do backup online.");

            saveData(); // Salva localmente para uso offline
            showToast("‚úÖ Dados atualizados do servidor!");
        } catch (error) {
            console.warn("‚ö†Ô∏è Falha ao carregar backup online:", error.message);

            // 2Ô∏è‚É£ Caso falhe, carrega do localStorage
            const savedData = localStorage.getItem("superAppMDRData");
            if (savedData) {
                Object.assign(appData, JSON.parse(savedData));
                console.log("üîÑ Dados carregados do armazenamento local.");
                showToast("üì¶ Dados locais carregados.");
            } else {
                Object.assign(appData, JSON.parse(JSON.stringify(initialData)));
                console.log("üì¶ Dados padr√£o iniciais carregados.");
                showToast("üÜï Dados iniciais carregados.");
            }
        } finally {
            if (!appData.version) appData.version = "1.0";
            if (!appData.appSettings) appData.appSettings = { logoUrl: "", logoSize: 8 };

            updateVersionDisplay();
            renderHeader();
            renderHomeScreen();

            if (loadingIndicator) loadingIndicator.classList.add('hidden');
        }
    }

    // ‚úÖ Pequeno aviso visual (toast)
    function showToast(message) {
        const toast = document.createElement("div");
        toast.textContent = message;
        toast.className =
            "fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white text-sm font-medium py-2 px-4 rounded-full shadow-lg animate-fadeIn";
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 4000);
    }

    function updateVersion() {
        let [major, minor] = appData.version.split('.').map(Number);
        minor++;
        if (minor >= 10) {
            minor = 0;
            major++;
        }
        appData.version = `${major}.${minor}`;
        updateVersionDisplay();
        saveData();
    }

    function updateVersionDisplay() {
        document.getElementById('version-display').innerText = `Vers√£o ${appData.version}`;
    }
</script>
